<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Avaliação - Ecoltarema</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
* { box-sizing:border-box; margin:0; padding:0; font-family:'Inter',sans-serif; }
body { background: #f5f5f5; min-height: 100vh; display:flex; flex-direction:column; }
.top-bar {
    height: 55px; background:#2e7d32; color:white;
    display:flex; align-items:center; justify-content:center;
    font-size:20px; font-weight:bold; position:relative;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.back-btn {
    position:absolute; left:12px; top:12px;
    font-size:24px; color:white; background:none; border:none; cursor:pointer;
}
.container {
    flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
    padding:30px 20px;
}
h1 { color:#222; margin:20px 0; }
.stars { display:flex; gap:10px; font-size:40px; cursor:pointer; margin-bottom:20px; }
.stars span { color:#ccc; transition: color 0.2s; }
.stars span.selected, .stars span:hover, .stars span:hover ~ span { color:#f5b301; }
textarea {
    width:100%; max-width:400px; height:120px; padding:12px;
    border-radius:10px; border:1px solid #ccc; font-size:14px; resize:none; margin-bottom:20px;
}
button.submit-btn {
    background:#1db954; color:white; border:none; padding:12px 20px;
    font-size:16px; border-radius:10px; cursor:pointer; transition: background 0.3s;
}
button.submit-btn:hover { background:#17a44d; }
</style>
</head>
<body>

<div class="top-bar">
    Avaliação
    <button class="back-btn" onclick="window.history.back()">←</button>
</div>

<div class="container">
    <h1>Avalie nosso app</h1>
    <div class="stars" id="stars">
        <span data-value="1">★</span>
        <span data-value="2">★</span>
        <span data-value="3">★</span>
        <span data-value="4">★</span>
        <span data-value="5">★</span>
    </div>
    <textarea id="comentario" placeholder="Deixe seu comentário..."></textarea>
    <button class="submit-btn" onclick="enviarAvaliacao()">Enviar Avaliação</button>
</div>

<script>
let notaSelecionada = 0;
const estrelas = document.querySelectorAll("#stars span");

estrelas.forEach(star => {
    star.addEventListener('click', () => {
        notaSelecionada = star.dataset.value;
        atualizarEstrelas();
    });
    star.addEventListener('mouseover', () => {
        const valor = star.dataset.value;
        estrelas.forEach(s => s.classList.toggle('selected', s.dataset.value <= valor));
    });
    star.addEventListener('mouseout', () => {
        atualizarEstrelas();
    });
});

function atualizarEstrelas() {
    estrelas.forEach(star => {
        star.classList.toggle('selected', star.dataset.value <= notaSelecionada);
    });
}

function enviarAvaliacao() {
    if(notaSelecionada == 0){
        alert("Selecione uma nota antes de enviar!");
        return;
    }
    const comentario = document.getElementById("comentario").value.trim();
    const emailLogado = localStorage.getItem("usuarioLogado");
    if(!emailLogado){
        alert("Faça login antes de avaliar.");
        return;
    }

    const avaliacoes = JSON.parse(localStorage.getItem("avaliacoes") || "[]");
    avaliacoes.push({ usuario: emailLogado, nota: notaSelecionada, comentario });
    localStorage.setItem("avaliacoes", JSON.stringify(avaliacoes));

    alert("Avaliação enviada com sucesso! Obrigado pelo seu feedback.");
    window.history.back();
}
</script>

</body>
</html>