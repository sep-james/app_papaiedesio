<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Menu Principal - Ecoltarema</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  html, body { height:100%; margin:0; font-family: Arial,sans-serif; background:#f5f5f5; overflow-x:hidden; }
  #map { height:100%; width:100%; }

  /* Barra superior */
  .top-bar { position:absolute; top:0; left:0; width:100%; height:55px;
    background:#2e7d32; color:#fff; display:flex; justify-content:center; align-items:center;
    font-size:20px; font-weight:bold; z-index:1000; box-shadow:0 2px 5px rgba(0,0,0,0.2);}
  .menu-btn, .notif-btn { position:absolute; top:12px; background:none; color:white; border:none;
    font-size:24px; cursor:pointer; z-index:1102; }
  .menu-btn { left:12px; } .notif-btn { right:12px; }

  /* Bot√µes de a√ß√£o */
  .action-btn { position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
    background:#4caf50; color:white; border:none; padding:14px 26px; font-size:16px; font-weight:bold;
    border-radius:30px; cursor:pointer; z-index:1000; box-shadow:0 4px 8px rgba(0,0,0,0.3); transition:0.2s; }
  .action-btn:hover { background:#43a047; }

  /* Menu lateral */
  .side-menu { position:fixed; top:0; left:-260px; width:260px; height:100%; background:#2e7d32; color:white;
    padding-top:60px; box-shadow:2px 0 5px rgba(0,0,0,0.5); transition:left 0.3s ease; z-index:1100;
    display:flex; flex-direction:column; align-items:center;}
  .side-menu.open { left:0; }
  .side-menu img.profile-pic { width:90px; height:90px; border-radius:50%; margin-bottom:10px; border:3px solid white; object-fit:cover;}
  .side-menu p { font-weight:bold; margin-bottom:15px; font-size:18px; }
  .side-menu button { background:none; border:none; color:white; font-size:18px; padding:15px 20px; text-align:left;
    cursor:pointer; border-bottom:1px solid #1b4d23; display:flex; align-items:center; width:100%; }
  .side-menu button:hover { background:#145623; }
  .side-menu button span.icon { margin-right:10px; font-size:22px; }

  /* Overlay */
  .overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:1050; display:none; }
  .overlay.show { display:block; }
</style>
</head>
<body>

<div class="top-bar">Recicle+</div>
<button class="menu-btn" id="btnMenu">‚ò∞</button>
<button class="notif-btn" onclick="window.location.href='notificacao.html'">üîî</button>

<!-- Bot√µes de a√ß√£o -->
<button id="btnDoador" class="action-btn" style="display:none" onclick="window.location.href='escolha.html'">Fa√ßa sua doa√ß√£o</button>
<button id="btnColetor" class="action-btn" style="display:none" onclick="window.location.href='coletor.html'">Veja as coletas do dia</button>

<div id="map"></div>

<!-- Menu lateral -->
<nav class="side-menu" id="sideMenu">
  <img id="fotoPerfil" src="perfil.jpg" alt="Foto de Perfil" class="profile-pic">
  <p id="nomePerfil"></p>

  <button onclick="window.location.href='abrirAvaliacao.html'"><span class="icon">‚≠ê</span>Avalia√ß√£o</button>
  <button onclick="window.location.href='perfil.html'"><span class="icon">üë§</span>Perfil</button>
  <button onclick="window.location.href='configuracao.html'"><span class="icon">‚öôÔ∏è</span>Configura√ß√£o</button>
  <button onclick="window.location.href='chat.html'"><span class="icon">üí¨</span>Chat</button>
  <button onclick="window.location.href='ranking.html'"><span class="icon">üèÜ</span>Ranking</button>
  <button onclick="logout()"><span class="icon">üîë</span>Sair</button>
</nav>

<div class="overlay" id="overlay"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Inicializa mapa
  const map = L.map('map', { zoomControl:false }).setView([-2.9245, -39.9167], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution:'¬© OpenStreetMap contributors'}).addTo(map);

  const iconeLixeira = L.divIcon({ html:'<div style="font-size:28px;">‚ôªÔ∏è</div>', className:'', iconSize:[28,28], iconAnchor:[14,28]});
  L.marker([-2.9286,-39.9195],{icon:iconeLixeira}).addTo(map).bindPopup("<b>Prefeitura de Itarema</b>");
  L.marker([-2.9184,-39.9180],{icon:iconeLixeira}).addTo(map).bindPopup("<b>Escola Marieta Rios</b>");
  L.marker([-2.9257,-39.9097],{icon:iconeLixeira}).addTo(map).bindPopup("<b>Posto 24 Horas</b>");

  // Recupera usu√°rio logado
  const emailLogado = localStorage.getItem("usuarioLogado") || sessionStorage.getItem("usuarioLogado");
  if(!emailLogado){ window.location.href = "login.html"; }

  const user = JSON.parse(localStorage.getItem(emailLogado));
  if(!user){ window.location.href = "login.html"; }

  // Mostra bot√£o correto
  if(user.tipo === "doador"){ document.getElementById("btnDoador").style.display = "block"; }
  else if(user.tipo === "coletor"){ document.getElementById("btnColetor").style.display = "block"; }

  // Preenche perfil
  document.getElementById("nomePerfil").innerText = user.nome || user.email;
  if(user.foto){ document.getElementById("fotoPerfil").src = user.foto; }

  // Menu lateral toggle
  const btnMenu = document.getElementById("btnMenu");
  const sideMenu = document.getElementById("sideMenu");
  const overlay = document.getElementById("overlay");

  btnMenu.addEventListener("click", () => { sideMenu.classList.add("open"); overlay.classList.add("show"); });
  overlay.addEventListener("click", () => { sideMenu.classList.remove("open"); overlay.classList.remove("show"); });

  // Fun√ß√£o logout
  function logout() {
      localStorage.removeItem("usuarioLogado");
      sessionStorage.removeItem("usuarioLogado");
      window.location.href = "login.html";
  }
</script>

</body>
</html>